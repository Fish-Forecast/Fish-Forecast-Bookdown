<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6.7 Prediction accuracy | Fisheries Catch Forecasting</title>
  <meta name="description" content="This book will show you how to model and forecast annual and seasonal fisheries catches using R and its time-series analysis functions and packages. Forecasting using time-varying regression, ARIMA (Box-Jenkins) models, and expoential smoothing models is demonstrated using real catch time series. The entire process from data evaluation and diagnostics, model fitting, model selection and forecast evaluation is shown. The focus of the book is on univariate time series (annual or seasonal), however multivariate regression with autocorrelated errors and multivariate autoregressive models (MAR) are covered briefly. For multivariate autoregressive models and multivariate autoregressive state-space models for fisheries and environmental sciences, see Holmes, Ward and Scheuerell (2018)." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="6.7 Prediction accuracy | Fisheries Catch Forecasting" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="This book will show you how to model and forecast annual and seasonal fisheries catches using R and its time-series analysis functions and packages. Forecasting using time-varying regression, ARIMA (Box-Jenkins) models, and expoential smoothing models is demonstrated using real catch time series. The entire process from data evaluation and diagnostics, model fitting, model selection and forecast evaluation is shown. The focus of the book is on univariate time series (annual or seasonal), however multivariate regression with autocorrelated errors and multivariate autoregressive models (MAR) are covered briefly. For multivariate autoregressive models and multivariate autoregressive state-space models for fisheries and environmental sciences, see Holmes, Ward and Scheuerell (2018)." />
  <meta name="github-repo" content="fish-forecast/Fish-Forecast-Bookdown/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6.7 Prediction accuracy | Fisheries Catch Forecasting" />
  
  <meta name="twitter:description" content="This book will show you how to model and forecast annual and seasonal fisheries catches using R and its time-series analysis functions and packages. Forecasting using time-varying regression, ARIMA (Box-Jenkins) models, and expoential smoothing models is demonstrated using real catch time series. The entire process from data evaluation and diagnostics, model fitting, model selection and forecast evaluation is shown. The focus of the book is on univariate time series (annual or seasonal), however multivariate regression with autocorrelated errors and multivariate autoregressive models (MAR) are covered briefly. For multivariate autoregressive models and multivariate autoregressive state-space models for fisheries and environmental sciences, see Holmes, Ward and Scheuerell (2018)." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Elizabeth Holmes" />


<meta name="date" content="2020-10-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="6-6-MREGORTHO.html"/>
<link rel="next" href="6-8-discussion.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html"><img src="./images/fish-forecast.jpg" width=50></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="1-introduction.html"><a href="1-introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="1-1-stergiou-and-christou-1996.html"><a href="1-1-stergiou-and-christou-1996.html"><i class="fa fa-check"></i><b>1.1</b> Stergiou and Christou 1996</a><ul>
<li class="chapter" data-level="1.1.1" data-path="1-1-stergiou-and-christou-1996.html"><a href="1-1-stergiou-and-christou-1996.html#landingsdata"><i class="fa fa-check"></i><b>1.1.1</b> Hellenic landings data</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-2-the-landings-data-and-covariates.html"><a href="1-2-the-landings-data-and-covariates.html"><i class="fa fa-check"></i><b>1.2</b> The landings data and covariates</a></li>
<li class="chapter" data-level="1.3" data-path="1-3-ts-objects.html"><a href="1-3-ts-objects.html"><i class="fa fa-check"></i><b>1.3</b> ts objects</a><ul>
<li class="chapter" data-level="1.3.1" data-path="1-3-ts-objects.html"><a href="1-3-ts-objects.html#ts-function"><i class="fa fa-check"></i><b>1.3.1</b> <code>ts()</code> function</a></li>
<li class="chapter" data-level="1.3.2" data-path="1-3-ts-objects.html"><a href="1-3-ts-objects.html#ggplot-and-ts-objects"><i class="fa fa-check"></i><b>1.3.2</b> ggplot and ts objects</a></li>
<li class="chapter" data-level="1.3.3" data-path="1-3-ts-objects.html"><a href="1-3-ts-objects.html#plotting-using-a-data-frame"><i class="fa fa-check"></i><b>1.3.3</b> Plotting using a data frame</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="1-4-packages.html"><a href="1-4-packages.html"><i class="fa fa-check"></i><b>1.4</b> Packages</a></li>
<li class="chapter" data-level="1.5" data-path="1-5-references.html"><a href="1-5-references.html"><i class="fa fa-check"></i><b>1.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-time-varying-regression.html"><a href="2-time-varying-regression.html"><i class="fa fa-check"></i><b>2</b> Time-varying regression</a><ul>
<li class="chapter" data-level="2.1" data-path="2-1-fitting.html"><a href="2-1-fitting.html"><i class="fa fa-check"></i><b>2.1</b> Fitting</a><ul>
<li class="chapter" data-level="2.1.1" data-path="2-1-fitting.html"><a href="2-1-fitting.html#orthogonal-polynomials"><i class="fa fa-check"></i><b>2.1.1</b> Orthogonal polynomials</a></li>
<li class="chapter" data-level="2.1.2" data-path="2-1-fitting.html"><a href="2-1-fitting.html#residual-diagnostics"><i class="fa fa-check"></i><b>2.1.2</b> Residual diagnostics</a></li>
<li class="chapter" data-level="2.1.3" data-path="2-1-fitting.html"><a href="2-1-fitting.html#compare-to-stergiou-and-christou"><i class="fa fa-check"></i><b>2.1.3</b> Compare to Stergiou and Christou</a></li>
<li class="chapter" data-level="2.1.4" data-path="2-1-fitting.html"><a href="2-1-fitting.html#summary"><i class="fa fa-check"></i><b>2.1.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2-2-forecasting.html"><a href="2-2-forecasting.html"><i class="fa fa-check"></i><b>2.2</b> Forecasting</a><ul>
<li class="chapter" data-level="2.2.1" data-path="2-2-forecasting.html"><a href="2-2-forecasting.html#the-forecast-package"><i class="fa fa-check"></i><b>2.2.1</b> The forecast package</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-1-fitting.html"><a href="2-1-fitting.html#summary"><i class="fa fa-check"></i><b>2.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-arima-models.html"><a href="3-arima-models.html"><i class="fa fa-check"></i><b>3</b> ARIMA Models</a><ul>
<li class="chapter" data-level="3.1" data-path="3-1-overview.html"><a href="3-1-overview.html"><i class="fa fa-check"></i><b>3.1</b> Overview</a><ul>
<li class="chapter" data-level="3.1.1" data-path="3-1-overview.html"><a href="3-1-overview.html#components-of-an-arima-model"><i class="fa fa-check"></i><b>3.1.1</b> Components of an ARIMA model</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-1-overview.html"><a href="3-1-overview.html#box-jenkins-method"><i class="fa fa-check"></i><b>3.1.2</b> Box-Jenkins method</a></li>
<li class="chapter" data-level="3.1.3" data-path="3-1-overview.html"><a href="3-1-overview.html#acf-and-pacf-functions"><i class="fa fa-check"></i><b>3.1.3</b> ACF and PACF functions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-2-stationarity.html"><a href="3-2-stationarity.html"><i class="fa fa-check"></i><b>3.2</b> Stationarity</a><ul>
<li class="chapter" data-level="3.2.1" data-path="3-2-stationarity.html"><a href="3-2-stationarity.html#definition"><i class="fa fa-check"></i><b>3.2.1</b> Definition</a></li>
<li class="chapter" data-level="3.2.2" data-path="3-2-stationarity.html"><a href="3-2-stationarity.html#non-stationarity"><i class="fa fa-check"></i><b>3.2.2</b> Non-stationarity</a></li>
<li class="chapter" data-level="3.2.3" data-path="3-2-stationarity.html"><a href="3-2-stationarity.html#stationarity-tests"><i class="fa fa-check"></i><b>3.2.3</b> Stationarity tests</a></li>
<li class="chapter" data-level="3.2.4" data-path="3-2-stationarity.html"><a href="3-2-stationarity.html#differencing-the-data"><i class="fa fa-check"></i><b>3.2.4</b> Differencing the data</a></li>
<li class="chapter" data-level="3.2.5" data-path="2-1-fitting.html"><a href="2-1-fitting.html#summary"><i class="fa fa-check"></i><b>3.2.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-3-model-structure.html"><a href="3-3-model-structure.html"><i class="fa fa-check"></i><b>3.3</b> Model structure</a><ul>
<li class="chapter" data-level="3.3.1" data-path="3-3-model-structure.html"><a href="3-3-model-structure.html#ar-and-ma-lags"><i class="fa fa-check"></i><b>3.3.1</b> AR and MA lags</a></li>
<li class="chapter" data-level="3.3.2" data-path="3-3-model-structure.html"><a href="3-3-model-structure.html#model-order"><i class="fa fa-check"></i><b>3.3.2</b> Model order</a></li>
<li class="chapter" data-level="3.3.3" data-path="3-3-model-structure.html"><a href="3-3-model-structure.html#choosing-the-ar-and-ma-levels"><i class="fa fa-check"></i><b>3.3.3</b> Choosing the AR and MA levels</a></li>
<li class="chapter" data-level="3.3.4" data-path="3-3-model-structure.html"><a href="3-3-model-structure.html#trace-true"><i class="fa fa-check"></i><b>3.3.4</b> Trace = TRUE</a></li>
<li class="chapter" data-level="3.3.5" data-path="3-3-model-structure.html"><a href="3-3-model-structure.html#stepwise-false"><i class="fa fa-check"></i><b>3.3.5</b> stepwise = FALSE</a></li>
<li class="chapter" data-level="3.3.6" data-path="2-1-fitting.html"><a href="2-1-fitting.html#summary"><i class="fa fa-check"></i><b>3.3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html"><i class="fa fa-check"></i><b>3.4</b> Fitting ARIMA models</a><ul>
<li class="chapter" data-level="3.4.1" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#fitting-with-auto.arima"><i class="fa fa-check"></i><b>3.4.1</b> Fitting with <code>auto.arima()</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#outputting-the-models-tested"><i class="fa fa-check"></i><b>3.4.2</b> Outputting the models tested</a></li>
<li class="chapter" data-level="3.4.3" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#repeat-with-the-sardine-data"><i class="fa fa-check"></i><b>3.4.3</b> Repeat with the sardine data</a></li>
<li class="chapter" data-level="3.4.4" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#missing-values"><i class="fa fa-check"></i><b>3.4.4</b> Missing values</a></li>
<li class="chapter" data-level="3.4.5" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#fit-a-specific-arima-model"><i class="fa fa-check"></i><b>3.4.5</b> Fit a specific ARIMA model</a></li>
<li class="chapter" data-level="3.4.6" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#model-checking"><i class="fa fa-check"></i><b>3.4.6</b> Model checking</a></li>
<li class="chapter" data-level="3.4.7" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#workflow-for-non-seasonal-data"><i class="fa fa-check"></i><b>3.4.7</b> Workflow for non-seasonal data</a></li>
<li class="chapter" data-level="3.4.8" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#stepwise-vs-exhaustive-model-selection"><i class="fa fa-check"></i><b>3.4.8</b> Stepwise vs exhaustive model selection</a></li>
<li class="chapter" data-level="3.4.9" data-path="2-1-fitting.html"><a href="2-1-fitting.html#summary"><i class="fa fa-check"></i><b>3.4.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="2-2-forecasting.html"><a href="2-2-forecasting.html#forecasting"><i class="fa fa-check"></i><b>3.5</b> Forecasting</a><ul>
<li class="chapter" data-level="3.5.1" data-path="3-5-forecasting.html"><a href="3-5-forecasting.html"><i class="fa fa-check"></i><b>3.5.1</b> Forecasting with <code>forecast()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#missing-values"><i class="fa fa-check"></i><b>3.5.2</b> Missing values</a></li>
<li class="chapter" data-level="3.5.3" data-path="3-5-forecasting.html"><a href="3-5-forecasting.html#null-forecast-models"><i class="fa fa-check"></i><b>3.5.3</b> Null forecast models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-exponential-smoothing-models.html"><a href="4-exponential-smoothing-models.html"><i class="fa fa-check"></i><b>4</b> Exponential smoothing models</a><ul>
<li class="chapter" data-level="4.1" data-path="3-1-overview.html"><a href="3-1-overview.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a><ul>
<li class="chapter" data-level="4.1.1" data-path="4-1-overview.html"><a href="4-1-overview.html"><i class="fa fa-check"></i><b>4.1.1</b> Naive model</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-1-overview.html"><a href="4-1-overview.html#exponential-smoothing"><i class="fa fa-check"></i><b>4.1.2</b> Exponential smoothing</a></li>
<li class="chapter" data-level="4.1.3" data-path="4-1-overview.html"><a href="4-1-overview.html#exponential-smoothing-model"><i class="fa fa-check"></i><b>4.1.3</b> Exponential smoothing model</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-2-ets-function.html"><a href="4-2-ets-function.html"><i class="fa fa-check"></i><b>4.2</b> <code>ets()</code> function</a><ul>
<li class="chapter" data-level="4.2.1" data-path="4-2-ets-function.html"><a href="4-2-ets-function.html#the-weighting-function"><i class="fa fa-check"></i><b>4.2.1</b> The weighting function</a></li>
<li class="chapter" data-level="4.2.2" data-path="4-2-ets-function.html"><a href="4-2-ets-function.html#decomposing-your-model-fit"><i class="fa fa-check"></i><b>4.2.2</b> Decomposing your model fit</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="4-3-ets-with-trend.html"><a href="4-3-ets-with-trend.html"><i class="fa fa-check"></i><b>4.3</b> ETS with trend</a><ul>
<li class="chapter" data-level="4.3.1" data-path="4-3-ets-with-trend.html"><a href="4-3-ets-with-trend.html#exponential-smoothing-model-with-trend"><i class="fa fa-check"></i><b>4.3.1</b> Exponential smoothing model with trend</a></li>
<li class="chapter" data-level="4.3.2" data-path="4-3-ets-with-trend.html"><a href="4-3-ets-with-trend.html#produce-forecast-using-a-previous-fit"><i class="fa fa-check"></i><b>4.3.2</b> Produce forecast using a previous fit</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="4-4-forecast-performance.html"><a href="4-4-forecast-performance.html"><i class="fa fa-check"></i><b>4.4</b> Forecast performance</a><ul>
<li class="chapter" data-level="4.4.1" data-path="4-4-forecast-performance.html"><a href="4-4-forecast-performance.html#test-forecast-performance"><i class="fa fa-check"></i><b>4.4.1</b> Test forecast performance</a></li>
<li class="chapter" data-level="4.4.2" data-path="4-4-forecast-performance.html"><a href="4-4-forecast-performance.html#testing-a-specific-ets-model"><i class="fa fa-check"></i><b>4.4.2</b> Testing a specific ets model</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="4-5-further-reading.html"><a href="4-5-further-reading.html"><i class="fa fa-check"></i><b>4.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-perf-testing.html"><a href="5-perf-testing.html"><i class="fa fa-check"></i><b>5</b> Testing forecast accuracy</a><ul>
<li class="chapter" data-level="5.1" data-path="5-1-training-settest-set.html"><a href="5-1-training-settest-set.html"><i class="fa fa-check"></i><b>5.1</b> Training set/test set</a><ul>
<li class="chapter" data-level="5.1.1" data-path="5-1-training-settest-set.html"><a href="5-1-training-settest-set.html#forecast-versus-actual"><i class="fa fa-check"></i><b>5.1.1</b> Forecast versus actual</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-2-cross-validation.html"><a href="5-2-cross-validation.html"><i class="fa fa-check"></i><b>5.2</b> Cross-Validation</a><ul>
<li class="chapter" data-level="5.2.1" data-path="5-2-cross-validation.html"><a href="5-2-cross-validation.html#variable-window"><i class="fa fa-check"></i><b>5.2.1</b> Variable window</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-2-cross-validation.html"><a href="5-2-cross-validation.html#fixed-window"><i class="fa fa-check"></i><b>5.2.2</b> Fixed window</a></li>
<li class="chapter" data-level="5.2.3" data-path="5-2-cross-validation.html"><a href="5-2-cross-validation.html#cross-validation-farther-into-the-future"><i class="fa fa-check"></i><b>5.2.3</b> Cross-validation farther into the future</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-3-metrics.html"><a href="5-3-metrics.html"><i class="fa fa-check"></i><b>5.3</b> Metrics</a><ul>
<li class="chapter" data-level="5.3.1" data-path="5-3-metrics.html"><a href="5-3-metrics.html#accuracy-function"><i class="fa fa-check"></i><b>5.3.1</b> <code>accuracy()</code> function</a></li>
<li class="chapter" data-level="5.3.2" data-path="5-3-metrics.html"><a href="5-3-metrics.html#test-multiple-models"><i class="fa fa-check"></i><b>5.3.2</b> Test multiple models</a></li>
<li class="chapter" data-level="5.3.3" data-path="5-2-cross-validation.html"><a href="5-2-cross-validation.html#cross-validation"><i class="fa fa-check"></i><b>5.3.3</b> Cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="5-4-candidate-model-set.html"><a href="5-4-candidate-model-set.html"><i class="fa fa-check"></i><b>5.4</b> Candidate model set</a></li>
<li class="chapter" data-level="5.5" data-path="5-5-testing-the-candidate-model-set.html"><a href="5-5-testing-the-candidate-model-set.html"><i class="fa fa-check"></i><b>5.5</b> Testing the candidate model set</a><ul>
<li class="chapter" data-level="5.5.1" data-path="5-5-testing-the-candidate-model-set.html"><a href="5-5-testing-the-candidate-model-set.html#fit-each-of-our-candidate-models"><i class="fa fa-check"></i><b>5.5.1</b> Fit each of our candidate models</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="5-6-models-fit.html"><a href="5-6-models-fit.html"><i class="fa fa-check"></i><b>5.6</b> Models fit</a><ul>
<li class="chapter" data-level="5.6.1" data-path="5-6-models-fit.html"><a href="5-6-models-fit.html#metrics-for-each-model"><i class="fa fa-check"></i><b>5.6.1</b> Metrics for each model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-covariates.html"><a href="6-covariates.html"><i class="fa fa-check"></i><b>6</b> Covariates</a><ul>
<li class="chapter" data-level="6.1" data-path="6-1-covariates-used-in-stergiou-and-christou.html"><a href="6-1-covariates-used-in-stergiou-and-christou.html"><i class="fa fa-check"></i><b>6.1</b> Covariates used in Stergiou and Christou</a><ul>
<li class="chapter" data-level="" data-path="6-1-covariates-used-in-stergiou-and-christou.html"><a href="6-1-covariates-used-in-stergiou-and-christou.html#preparing-the-data-frame"><i class="fa fa-check"></i>Preparing the data frame</a></li>
<li class="chapter" data-level="6.1.1" data-path="6-1-covariates-used-in-stergiou-and-christou.html"><a href="6-1-covariates-used-in-stergiou-and-christou.html#cov.df"><i class="fa fa-check"></i><b>6.1.1</b> Creating the data frame for model fitting</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="6-2-collinear.html"><a href="6-2-collinear.html"><i class="fa fa-check"></i><b>6.2</b> Collinearity</a><ul>
<li class="chapter" data-level="6.2.1" data-path="6-2-collinear.html"><a href="6-2-collinear.html#effect-of-collinearity"><i class="fa fa-check"></i><b>6.2.1</b> Effect of collinearity</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="6-3-MREGVAR.html"><a href="6-3-MREGVAR.html"><i class="fa fa-check"></i><b>6.3</b> Variable selection</a><ul>
<li class="chapter" data-level="6.3.1" data-path="6-3-MREGVAR.html"><a href="6-3-MREGVAR.html#stepwise-sel"><i class="fa fa-check"></i><b>6.3.1</b> Model selection with stepwise variable selection</a></li>
<li class="chapter" data-level="6.3.2" data-path="6-3-MREGVAR.html"><a href="6-3-MREGVAR.html#model-selection-with-cross-validationislcv"><i class="fa fa-check"></i><b>6.3.2</b> Model selection with cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="6-4-MREGPR.html"><a href="6-4-MREGPR.html"><i class="fa fa-check"></i><b>6.4</b> Penalized regression</a><ul>
<li class="chapter" data-level="6.4.1" data-path="6-4-MREGPR.html"><a href="6-4-MREGPR.html#ridge-regression"><i class="fa fa-check"></i><b>6.4.1</b> Ridge Regression</a></li>
<li class="chapter" data-level="6.4.2" data-path="6-4-MREGPR.html"><a href="6-4-MREGPR.html#lasso"><i class="fa fa-check"></i><b>6.4.2</b> Lasso</a></li>
<li class="chapter" data-level="6.4.3" data-path="6-4-MREGPR.html"><a href="6-4-MREGPR.html#elastic-net"><i class="fa fa-check"></i><b>6.4.3</b> Elastic net</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="6-5-MREGRELPO.html"><a href="6-5-MREGRELPO.html"><i class="fa fa-check"></i><b>6.5</b> Relative importance metrics</a></li>
<li class="chapter" data-level="6.6" data-path="6-6-MREGORTHO.html"><a href="6-6-MREGORTHO.html"><i class="fa fa-check"></i><b>6.6</b> Orthogonalization</a></li>
<li class="chapter" data-level="6.7" data-path="6-7-MREGPREDICT.html"><a href="6-7-MREGPREDICT.html"><i class="fa fa-check"></i><b>6.7</b> Prediction accuracy</a></li>
<li class="chapter" data-level="6.8" data-path="6-8-discussion.html"><a href="6-8-discussion.html"><i class="fa fa-check"></i><b>6.8</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-ar-models-with-covariates.html"><a href="7-ar-models-with-covariates.html"><i class="fa fa-check"></i><b>7</b> AR models with covariates</a><ul>
<li class="chapter" data-level="7.1" data-path="7-1-MREGARMA.html"><a href="7-1-MREGARMA.html"><i class="fa fa-check"></i><b>7.1</b> MREG with ARMA errors</a><ul>
<li class="chapter" data-level="7.1.1" data-path="7-1-MREGARMA.html"><a href="7-1-MREGARMA.html#example-fitting-with-auto.arima"><i class="fa fa-check"></i><b>7.1.1</b> Example: fitting with auto.arima</a></li>
<li class="chapter" data-level="7.1.2" data-path="7-1-MREGARMA.html"><a href="7-1-MREGARMA.html#example-fitting-with-arima-and-sarima"><i class="fa fa-check"></i><b>7.1.2</b> Example: fitting with arima and sarima</a></li>
<li class="chapter" data-level="7.1.3" data-path="7-1-MREGARMA.html"><a href="7-1-MREGARMA.html#example-fitting-with-gls"><i class="fa fa-check"></i><b>7.1.3</b> Example: fitting with gls</a></li>
<li class="chapter" data-level="7.1.4" data-path="7-1-MREGARMA.html"><a href="7-1-MREGARMA.html#mreg-of-first-or-second-differences"><i class="fa fa-check"></i><b>7.1.4</b> MREG of first or second differences</a></li>
<li class="chapter" data-level="7.1.5" data-path="6-8-discussion.html"><a href="6-8-discussion.html#discussion"><i class="fa fa-check"></i><b>7.1.5</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="7-2-ARMAX.html"><a href="7-2-ARMAX.html"><i class="fa fa-check"></i><b>7.2</b> ARMAX Models</a><ul>
<li class="chapter" data-level="7.2.1" data-path="6-8-discussion.html"><a href="6-8-discussion.html#discussion"><i class="fa fa-check"></i><b>7.2.1</b> Discussion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-seasonality.html"><a href="8-seasonality.html"><i class="fa fa-check"></i><b>8</b> Seasonality</a><ul>
<li class="chapter" data-level="8.1" data-path="8-1-chinook-data.html"><a href="8-1-chinook-data.html"><i class="fa fa-check"></i><b>8.1</b> Chinook data</a><ul>
<li class="chapter" data-level="" data-path="8-1-chinook-data.html"><a href="8-1-chinook-data.html#load-the-chinook-salmon-data-set"><i class="fa fa-check"></i>Load the chinook salmon data set</a></li>
<li class="chapter" data-level="" data-path="8-1-chinook-data.html"><a href="8-1-chinook-data.html#plot-seasonal-data"><i class="fa fa-check"></i>Plot seasonal data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="8-2-seasonal-exponential-smoothing-model.html"><a href="8-2-seasonal-exponential-smoothing-model.html"><i class="fa fa-check"></i><b>8.2</b> Seasonal Exponential Smoothing Model</a><ul>
<li class="chapter" data-level="8.2.1" data-path="8-2-seasonal-exponential-smoothing-model.html"><a href="8-2-seasonal-exponential-smoothing-model.html#force-seasonality-to-evolve-more"><i class="fa fa-check"></i><b>8.2.1</b> Force seasonality to evolve more</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="8-3-seasonal-arima-model.html"><a href="8-3-seasonal-arima-model.html"><i class="fa fa-check"></i><b>8.3</b> Seasonal ARIMA model</a></li>
<li class="chapter" data-level="8.4" data-path="3-4-fitting-arima-models.html"><a href="3-4-fitting-arima-models.html#missing-values"><i class="fa fa-check"></i><b>8.4</b> Missing values</a></li>
<li class="chapter" data-level="8.5" data-path="8-5-forecast-evaluation.html"><a href="8-5-forecast-evaluation.html"><i class="fa fa-check"></i><b>8.5</b> Forecast evaluation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="1-5-references.html"><a href="1-5-references.html#references"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="A-inputting-data.html"><a href="A-inputting-data.html"><i class="fa fa-check"></i><b>A</b> Inputting data</a><ul>
<li class="chapter" data-level="" data-path="A-inputting-data.html"><a href="A-inputting-data.html#one-response-variable"><i class="fa fa-check"></i>one response variable</a></li>
<li class="chapter" data-level="" data-path="A-inputting-data.html"><a href="A-inputting-data.html#many-response-variables"><i class="fa fa-check"></i>Many response variables</a></li>
<li class="chapter" data-level="" data-path="A-inputting-data.html"><a href="A-inputting-data.html#many-response-variables-two-time-variables"><i class="fa fa-check"></i>Many response variables, two time variables</a></li>
<li class="chapter" data-level="" data-path="A-inputting-data.html"><a href="A-inputting-data.html#one-response-variable-multiple-explanatory-variables"><i class="fa fa-check"></i>One response variable, multiple explanatory variables</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="B-downloading-icoads-covariates.html"><a href="B-downloading-icoads-covariates.html"><i class="fa fa-check"></i><b>B</b> Downloading ICOADS covariates</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fisheries Catch Forecasting</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="MREGPREDICT" class="section level2">
<h2><span class="header-section-number">6.7</span> Prediction accuracy</h2>
<!--
if(file.exists("Fish-Forecast.Rmd")) file.remove("Fish-Forecast.Rmd")
bookdown::preview_chapter("Forecasting-6-2-Covariates-MSEG.Rmd")
-->
<p>We could use cross-validation compare prediction accuracy if we had a pre-defined set of models to compare. In our case, we do not have a set of models but rather a set of “number of variables” and the specific variables to include in that number are determined using the fit to the data (in some fashion). We cannot use variable selection (any sort) with our full dataset to chose the variables and then turn around and use cross-validation with the same dataset to test the out-of-sample prediction accuracy. Anytime you double-use your data like that, you will have severe bias problems.</p>
<!--
Discussion of this issue
https://stats.stackexchange.com/questions/27750/feature-selection-and-cross-validation/27751#27751
-->
<p>Instead, we will test our models using sets of years that we held out for testing, i.e. that were not used for fitting the model or selecting variates. We will use the following test years: 1988 and 1989 as was used in Stergiou and Christou and 1988-1992 (five years). We will use the performance testing procedure in Chapter <a href="5-perf-testing.html#perf-testing">5</a>.</p>
<div id="computing-the-prediction-error-for-a-model" class="section level4 unnumbered">
<h4>Computing the prediction error for a model</h4>
<p>First we set up the test data frames.</p>
<p>We can then compute the RMSE for the predictions from one of our linear regression models. Let’s use the model selected by <code>step()</code> using AIC as the metric and stepwise variable regression starting from a full model, <code>step.full</code>.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="6-7-MREGPREDICT.html#cb335-1"></a>fr &lt;-<span class="st"> </span><span class="kw">predict</span>(step.full, <span class="dt">newdata=</span>testdata2)</span>
<span id="cb335-2"><a href="6-7-MREGPREDICT.html#cb335-2"></a>err &lt;-<span class="st"> </span>fr <span class="op">-</span><span class="st"> </span>testdata2<span class="op">$</span>anchovy</span>
<span id="cb335-3"><a href="6-7-MREGPREDICT.html#cb335-3"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>(err<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 0.05289656</code></pre>
<p>We could also use <code>forecast()</code> in the forecast package to compute predictions and then use <code>accuracy()</code> to compute the prediction metrics for the test data.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="6-7-MREGPREDICT.html#cb337-1"></a>fr &lt;-<span class="st"> </span>forecast<span class="op">::</span><span class="kw">forecast</span>(step.full, <span class="dt">newdata=</span>testdata2)</span>
<span id="cb337-2"><a href="6-7-MREGPREDICT.html#cb337-2"></a>forecast<span class="op">::</span><span class="kw">accuracy</span>(fr, testdata2)</span></code></pre></div>
<pre><code>##                       ME       RMSE        MAE         MPE      MAPE      MASE
## Training set  0.00000000 0.11151614 0.08960780 -0.01540787 0.9925324 0.2480860
## Test set     -0.03755081 0.05289656 0.03755081 -0.39104145 0.3910415 0.1039623</code></pre>
</div>
<div id="comparing-the-predictions-for-a-suite-of-models" class="section level4 unnumbered">
<h4>Comparing the predictions for a suite of models</h4>
<p>Let’s compare a suite of models and compare predictions for the full out-of-sample data that we have: 1988 to 2007.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="6-7-MREGPREDICT.html#cb339-1"></a>fr.list &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb339-2"><a href="6-7-MREGPREDICT.html#cb339-2"></a>testdat &lt;-<span class="st"> </span>testdata.full &lt;-<span class="st"> </span>df.full[<span class="dv">24</span><span class="op">:</span><span class="kw">nrow</span>(df.full),]</span>
<span id="cb339-3"><a href="6-7-MREGPREDICT.html#cb339-3"></a>n.fr &lt;-<span class="st"> </span><span class="kw">length</span>(testdat)</span></code></pre></div>
<p>Then we fit the three best lm models chosen via stepwise regression, exhaustive search or cross-validation:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="6-7-MREGPREDICT.html#cb340-1"></a>modelname &lt;-<span class="st"> &quot;Year+FIP&quot;</span></span>
<span id="cb340-2"><a href="6-7-MREGPREDICT.html#cb340-2"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(anchovy<span class="op">~</span>Year<span class="op">+</span>FIP, <span class="dt">data=</span>df)</span>
<span id="cb340-3"><a href="6-7-MREGPREDICT.html#cb340-3"></a>fr.list[[modelname]] &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newdata=</span>testdat)</span>
<span id="cb340-4"><a href="6-7-MREGPREDICT.html#cb340-4"></a></span>
<span id="cb340-5"><a href="6-7-MREGPREDICT.html#cb340-5"></a>modelname &lt;-<span class="st"> &quot;Year+Trachurus+FIP&quot;</span></span>
<span id="cb340-6"><a href="6-7-MREGPREDICT.html#cb340-6"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(anchovy<span class="op">~</span>Year<span class="op">+</span>Trachurus<span class="op">+</span>FIP, <span class="dt">data=</span>df)</span>
<span id="cb340-7"><a href="6-7-MREGPREDICT.html#cb340-7"></a>fr.list[[modelname]] &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newdata=</span>testdat)</span>
<span id="cb340-8"><a href="6-7-MREGPREDICT.html#cb340-8"></a></span>
<span id="cb340-9"><a href="6-7-MREGPREDICT.html#cb340-9"></a>modelname &lt;-<span class="st"> &quot;6 variables&quot;</span></span>
<span id="cb340-10"><a href="6-7-MREGPREDICT.html#cb340-10"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(anchovy<span class="op">~</span>Year<span class="op">+</span>air<span class="op">+</span>vwnd<span class="op">+</span>BOP<span class="op">+</span>FIP<span class="op">+</span>TOP, <span class="dt">data=</span>df)</span>
<span id="cb340-11"><a href="6-7-MREGPREDICT.html#cb340-11"></a>fr.list[[modelname]] &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newdata=</span>testdat)</span></code></pre></div>
<p>Then we add the forecasts for Ridge Regression.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="6-7-MREGPREDICT.html#cb341-1"></a><span class="kw">library</span>(glmnet)</span>
<span id="cb341-2"><a href="6-7-MREGPREDICT.html#cb341-2"></a>resp &lt;-<span class="st"> </span><span class="kw">colnames</span>(df)<span class="op">!=</span><span class="st">&quot;anchovy&quot;</span></span>
<span id="cb341-3"><a href="6-7-MREGPREDICT.html#cb341-3"></a>x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df[,resp])</span>
<span id="cb341-4"><a href="6-7-MREGPREDICT.html#cb341-4"></a>y &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df[,<span class="st">&quot;anchovy&quot;</span>])</span>
<span id="cb341-5"><a href="6-7-MREGPREDICT.html#cb341-5"></a>fit &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x, y, <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="dt">alpha=</span><span class="dv">0</span>)</span>
<span id="cb341-6"><a href="6-7-MREGPREDICT.html#cb341-6"></a>n &lt;-<span class="st"> </span><span class="dv">20</span>; s &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb341-7"><a href="6-7-MREGPREDICT.html#cb341-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) s &lt;-<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="kw">cv.glmnet</span>(x, y, <span class="dt">nfolds=</span><span class="dv">5</span>, <span class="dt">alpha=</span><span class="dv">0</span>)<span class="op">$</span>lambda.min</span>
<span id="cb341-8"><a href="6-7-MREGPREDICT.html#cb341-8"></a>s.best &lt;-<span class="st"> </span>s<span class="op">/</span>n</span>
<span id="cb341-9"><a href="6-7-MREGPREDICT.html#cb341-9"></a></span>
<span id="cb341-10"><a href="6-7-MREGPREDICT.html#cb341-10"></a>modelname &lt;-<span class="st"> &quot;Ridge Regression&quot;</span></span>
<span id="cb341-11"><a href="6-7-MREGPREDICT.html#cb341-11"></a>newx &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(testdat[,resp])</span>
<span id="cb341-12"><a href="6-7-MREGPREDICT.html#cb341-12"></a>fr.list[[modelname]] &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newx=</span>newx, <span class="dt">s=</span>s.best)</span></code></pre></div>
<p>LASSO regression,</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="6-7-MREGPREDICT.html#cb342-1"></a>fit &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x, y, <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="dt">alpha=</span><span class="dv">1</span>)</span>
<span id="cb342-2"><a href="6-7-MREGPREDICT.html#cb342-2"></a>n &lt;-<span class="st"> </span><span class="dv">20</span>; s &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb342-3"><a href="6-7-MREGPREDICT.html#cb342-3"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) s &lt;-<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="kw">cv.glmnet</span>(x, y, <span class="dt">nfolds=</span><span class="dv">5</span>, <span class="dt">alpha=</span><span class="dv">1</span>)<span class="op">$</span>lambda.min</span>
<span id="cb342-4"><a href="6-7-MREGPREDICT.html#cb342-4"></a>s.best &lt;-<span class="st"> </span>s<span class="op">/</span>n</span>
<span id="cb342-5"><a href="6-7-MREGPREDICT.html#cb342-5"></a></span>
<span id="cb342-6"><a href="6-7-MREGPREDICT.html#cb342-6"></a>modelname &lt;-<span class="st"> &quot;LASSO Regression&quot;</span></span>
<span id="cb342-7"><a href="6-7-MREGPREDICT.html#cb342-7"></a>newx &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(testdat[,resp])</span>
<span id="cb342-8"><a href="6-7-MREGPREDICT.html#cb342-8"></a>fr.list[[modelname]] &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newx=</span>newx, <span class="dt">s=</span>s.best)</span></code></pre></div>
<p>and elastic net regression.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="6-7-MREGPREDICT.html#cb343-1"></a>fit &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x, y, <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb343-2"><a href="6-7-MREGPREDICT.html#cb343-2"></a>n &lt;-<span class="st"> </span><span class="dv">20</span>; s &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb343-3"><a href="6-7-MREGPREDICT.html#cb343-3"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) s &lt;-<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="kw">cv.glmnet</span>(x, y, <span class="dt">nfolds=</span><span class="dv">5</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>)<span class="op">$</span>lambda.min</span>
<span id="cb343-4"><a href="6-7-MREGPREDICT.html#cb343-4"></a>s.best &lt;-<span class="st"> </span>s<span class="op">/</span>n</span>
<span id="cb343-5"><a href="6-7-MREGPREDICT.html#cb343-5"></a></span>
<span id="cb343-6"><a href="6-7-MREGPREDICT.html#cb343-6"></a>modelname &lt;-<span class="st"> &quot;Elastic net Regression&quot;</span></span>
<span id="cb343-7"><a href="6-7-MREGPREDICT.html#cb343-7"></a>newx &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(testdat[,resp])</span>
<span id="cb343-8"><a href="6-7-MREGPREDICT.html#cb343-8"></a>fr.list[[modelname]] &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newx=</span>newx, <span class="dt">s=</span>s.best)</span></code></pre></div>
<p>Now we can create a table</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="6-7-MREGPREDICT.html#cb344-1"></a>restab &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dv">1</span>,<span class="dv">21</span>))</span>
<span id="cb344-2"><a href="6-7-MREGPREDICT.html#cb344-2"></a><span class="co">#restab &lt;- data.frame(model=&quot;&quot;, stringsAsFactors=FALSE)</span></span>
<span id="cb344-3"><a href="6-7-MREGPREDICT.html#cb344-3"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(fr.list)){</span>
<span id="cb344-4"><a href="6-7-MREGPREDICT.html#cb344-4"></a>  err &lt;-<span class="st"> </span>fr.list[[i]]<span class="op">-</span>testdat<span class="op">$</span>anchovy</span>
<span id="cb344-5"><a href="6-7-MREGPREDICT.html#cb344-5"></a>  restab[i,<span class="dv">2</span><span class="op">:</span>(<span class="kw">length</span>(err)<span class="op">+</span><span class="dv">1</span>)] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">cumsum</span>(err<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(err))</span>
<span id="cb344-6"><a href="6-7-MREGPREDICT.html#cb344-6"></a>  restab[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">names</span>(fr.list)[i]</span>
<span id="cb344-7"><a href="6-7-MREGPREDICT.html#cb344-7"></a>}</span>
<span id="cb344-8"><a href="6-7-MREGPREDICT.html#cb344-8"></a>tmp &lt;-<span class="st"> </span>restab[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">16</span>,<span class="dv">21</span>)]</span>
<span id="cb344-9"><a href="6-7-MREGPREDICT.html#cb344-9"></a><span class="kw">colnames</span>(tmp) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;model&quot;</span>,<span class="st">&quot;5 yrs&quot;</span>, <span class="st">&quot;10 yrs&quot;</span>, <span class="st">&quot;15 yrs&quot;</span>, <span class="st">&quot;20 yrs&quot;</span>)</span>
<span id="cb344-10"><a href="6-7-MREGPREDICT.html#cb344-10"></a>knitr<span class="op">::</span><span class="kw">kable</span>(tmp)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">5 yrs</th>
<th align="right">10 yrs</th>
<th align="right">15 yrs</th>
<th align="right">20 yrs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year+FIP</td>
<td align="right">0.6905211</td>
<td align="right">0.8252467</td>
<td align="right">0.9733136</td>
<td align="right">1.0597621</td>
</tr>
<tr class="even">
<td align="left">Year+Trachurus+FIP</td>
<td align="right">0.8324962</td>
<td align="right">0.9598570</td>
<td align="right">1.2391294</td>
<td align="right">1.4442466</td>
</tr>
<tr class="odd">
<td align="left">6 variables</td>
<td align="right">0.3612936</td>
<td align="right">0.6716181</td>
<td align="right">0.9543952</td>
<td align="right">1.1356324</td>
</tr>
<tr class="even">
<td align="left">Ridge Regression</td>
<td align="right">0.7822712</td>
<td align="right">0.8393271</td>
<td align="right">0.9564713</td>
<td align="right">0.9673194</td>
</tr>
<tr class="odd">
<td align="left">LASSO Regression</td>
<td align="right">0.5959503</td>
<td align="right">0.7471635</td>
<td align="right">1.0132615</td>
<td align="right">1.1769412</td>
</tr>
<tr class="even">
<td align="left">Elastic net Regression</td>
<td align="right">0.7092379</td>
<td align="right">0.8589573</td>
<td align="right">1.1609910</td>
<td align="right">1.3481830</td>
</tr>
</tbody>
</table>
<p>If we plot the forecasts with the 1965-1987 data (open circles) and the 1988-2007 data (solid circles), we see that the forecasts continue the upward trend in the data while the data level off.</p>
<p><img src="Fish-Forecast_files/figure-html/unnamed-chunk-105-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This illustrates a problem with using “Year” as a covariate. This covariate is deterministically increasing. If it is included in the model, then the forecasts will have an upward or downward trend. When using environmental, biological and effort covariates, one hopes that the covariates explain the trends in the data. It would be wiser to not use “Year” as a covariate.</p>
<p>LASSO regression with no year,</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="6-7-MREGPREDICT.html#cb345-1"></a>resp &lt;-<span class="st"> </span><span class="kw">colnames</span>(df)<span class="op">!=</span><span class="st">&quot;anchovy&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">colnames</span>(df)<span class="op">!=</span><span class="st">&quot;Year&quot;</span></span>
<span id="cb345-2"><a href="6-7-MREGPREDICT.html#cb345-2"></a>x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df[,resp])</span>
<span id="cb345-3"><a href="6-7-MREGPREDICT.html#cb345-3"></a>y &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df[,<span class="st">&quot;anchovy&quot;</span>])</span>
<span id="cb345-4"><a href="6-7-MREGPREDICT.html#cb345-4"></a>fit.lasso &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x, y, <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="dt">alpha=</span><span class="dv">1</span>)</span>
<span id="cb345-5"><a href="6-7-MREGPREDICT.html#cb345-5"></a>n &lt;-<span class="st"> </span><span class="dv">20</span>; s &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb345-6"><a href="6-7-MREGPREDICT.html#cb345-6"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) s &lt;-<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="kw">cv.glmnet</span>(x, y, <span class="dt">nfolds=</span><span class="dv">5</span>, <span class="dt">alpha=</span><span class="dv">1</span>)<span class="op">$</span>lambda.min</span>
<span id="cb345-7"><a href="6-7-MREGPREDICT.html#cb345-7"></a>s.best.lasso &lt;-<span class="st"> </span>s<span class="op">/</span>n</span>
<span id="cb345-8"><a href="6-7-MREGPREDICT.html#cb345-8"></a></span>
<span id="cb345-9"><a href="6-7-MREGPREDICT.html#cb345-9"></a>modelname &lt;-<span class="st"> &quot;LASSO Reg no Year&quot;</span></span>
<span id="cb345-10"><a href="6-7-MREGPREDICT.html#cb345-10"></a>newx &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(testdat[,resp])</span>
<span id="cb345-11"><a href="6-7-MREGPREDICT.html#cb345-11"></a>fr.list[[modelname]] &lt;-<span class="st"> </span><span class="kw">predict</span>(fit.lasso, <span class="dt">newx=</span>newx, <span class="dt">s=</span>s.best.lasso)</span></code></pre></div>
<p>Ridge regression with no year,</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="6-7-MREGPREDICT.html#cb346-1"></a>resp &lt;-<span class="st"> </span><span class="kw">colnames</span>(df)<span class="op">!=</span><span class="st">&quot;anchovy&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">colnames</span>(df)<span class="op">!=</span><span class="st">&quot;Year&quot;</span></span>
<span id="cb346-2"><a href="6-7-MREGPREDICT.html#cb346-2"></a>x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df[,resp])</span>
<span id="cb346-3"><a href="6-7-MREGPREDICT.html#cb346-3"></a>y &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df[,<span class="st">&quot;anchovy&quot;</span>])</span>
<span id="cb346-4"><a href="6-7-MREGPREDICT.html#cb346-4"></a>fit.ridge &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x, y, <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="dt">alpha=</span><span class="dv">0</span>)</span>
<span id="cb346-5"><a href="6-7-MREGPREDICT.html#cb346-5"></a>n &lt;-<span class="st"> </span><span class="dv">20</span>; s &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb346-6"><a href="6-7-MREGPREDICT.html#cb346-6"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) s &lt;-<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="kw">cv.glmnet</span>(x, y, <span class="dt">nfolds=</span><span class="dv">5</span>, <span class="dt">alpha=</span><span class="dv">1</span>)<span class="op">$</span>lambda.min</span>
<span id="cb346-7"><a href="6-7-MREGPREDICT.html#cb346-7"></a>s.best.ridge &lt;-<span class="st"> </span>s<span class="op">/</span>n</span>
<span id="cb346-8"><a href="6-7-MREGPREDICT.html#cb346-8"></a></span>
<span id="cb346-9"><a href="6-7-MREGPREDICT.html#cb346-9"></a>modelname &lt;-<span class="st"> &quot;Ridge Reg no Year&quot;</span></span>
<span id="cb346-10"><a href="6-7-MREGPREDICT.html#cb346-10"></a>newx &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(testdat[,resp])</span>
<span id="cb346-11"><a href="6-7-MREGPREDICT.html#cb346-11"></a>fr.list[[modelname]] &lt;-<span class="st"> </span><span class="kw">predict</span>(fit.ridge, <span class="dt">newx=</span>newx, <span class="dt">s=</span>s.best.ridge)</span></code></pre></div>
<p>Now we can create a table</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">model</th>
<th align="right">5 yrs</th>
<th align="right">10 yrs</th>
<th align="right">15 yrs</th>
<th align="right">20 yrs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">7</td>
<td align="left">LASSO Reg no Year</td>
<td align="right">0.7277462</td>
<td align="right">0.7200965</td>
<td align="right">0.7306603</td>
<td align="right">0.6668768</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="left">Ridge Reg no Year</td>
<td align="right">0.9741012</td>
<td align="right">0.9555257</td>
<td align="right">0.9792060</td>
<td align="right">0.9121324</td>
</tr>
</tbody>
</table>
<p><img src="Fish-Forecast_files/figure-html/unnamed-chunk-108-1.png" width="672" style="display: block; margin: auto;" />
Without “Year”, the model predicts 1988 well (using 1987 covariates) but then has a large jump upward after which is has a similar “flat-ish” trend as seen after 1989. What happened in 1988 (the covariate year affecting 1989)? The horsepower covariate, along with BOP (total boats) and TOP (boat tonnage), have a sudden upward jump in 1988. This is seen in all the fisheries. This suggests that in 1988 either a large number of new boats entered all the fisheries or what boats were counted as “purse seiners” was changed. Upon looking at the covariates, it seems that something changed in the recording from 1988 to 1996.</p>
<p><img src="Fish-Forecast_files/figure-html/unnamed-chunk-109-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>If we correct that jump from 1988 to 1989 (subtract the jump from all data 1989 onward), the Lasso and Ridge predictions without year look considerably better.</p>
<p><img src="Fish-Forecast_files/figure-html/unnamed-chunk-112-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="6-6-MREGORTHO.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="6-8-discussion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fish-forecast/Fish-Forecast-Bookdown/edit/master/Forecasting-6-6-MREG-prediction-error.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
