## Multivariate linear regression with ARMA errors

```{r f62-load_packages, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
```


The `stats::arima()` and `forecast::auto.arima()` functions with argument `xreg` fit a multivariate linear regression with ARMA errors.  Note, this is not what is termed a ARMAX model. ARMAX models will be addressed separately.  

The model fitted when `xreg` is passed in is:

\begin{equation}
\begin{gathered}
x_t = \alpha + \phi_1 c_{t,1} + \phi_2 c_{t,2} + \dots + z_t \\
z_t = \beta_1 z_{t-1} + \dots + \beta_p z_{t-p} + e_t + \theta_1 e_{t-1} + \dots + \theta_q e_{t-q}\\
e_t \sim N(0,\sigma)
\end{gathered}
\end{equation}
where `xreg` is  matrix with $c_{t,1}$ in column 1, $c_{t-2}$ in column 2, etc.  $z_t$ are the ARMA errors.

### Covariates used in Stergiou and Christou

Stergiou and Christou used five environmental covariates: air temperature (air), sea-level pressure (slp), sea surface temperature (sst), vertical wind speed (vwnd), and wind speed cubed (wspd3).  Monthly values for these covariates in three 1 degree boxes were taken from the COADS database, and then a yearly average over all months in the three boxes was used to compute a yearly average.

These yearly average environmental covariates are in `covsmean.year`, which is part of `landings.RData`.

```{r f37-load_data}
load("landings.RData")
colnames(covsmean.year)
```

The covariates are those in Stergiou and Christou with the following differences. I used the ICOADS data not the COADSs.  The boxes are 1 degree but on 1 degree centers not 0.5 centers.  Thus box is 39.5-40.5 not 39-40.  ICOADS does not include 'vertical wind'.  I used NS winds which may be different.  The code to download the ICOADS data is in the appendix.

In addition to the environmental covariates, Stergiou and Christou used many covariates of fishing effort for trawlers, purse seiners, beach seiners, other coastal boats and demersal (sum of trawlers, beach seiners and other coastal boats).  For each fishery type, they used data on number of fishers, number of boats, total engine horse power, total boat tonnage.  They also used an economic variable: value of catch for trawlers, purse seiners, beach seiners, other coastal boats.

In the MREG models, the covariates were lagged by one year.  This means that the catch in year $t$ is regressed against the covariates in year $t-1$. 

#### Prepare the data

We will start by creating a dataframe with our response variable and independent variables.  We will model anchovy landings as the response variable.

```{r cov.dataframe}
df <- data.frame(catch=anchovy$log.metric.tons)
df <- cbind(df, 
            subset(covsmean.year, Year<=2007)[,-1], 
            fish.cov[,-1])
```


### Model selection

In total, they had 26 covariates, many of which were highly correlated.  The covariate to include were selected with stepwise variable selection.  Stepwise variable selection is a type of automatic variable selection.  Note stepwise variable selection has many problems and the problems are worse when the covariates are collinear as they are in this example (see this [link](https://www.stata.com/support/faqs/statistics/stepwise-regression-problems/) for a review). However I use it here to replicate Stergiou and Christou.

```{r stepwise.reg}
step(null, scope=list(upper=full), data=df, direction="both")
```

#### A better approach to model selection in multivariate regresson {-}


### MREG of first or second differences

In the multivariate regression with ARMA errors, the response variable $x_t$ is not necessarily stationary since the covariates $c_t$'s need not be stationary.  If we wish to model the first or second differences of $x_t$, then we are potentially modeling a stationary process if differencing leads to a stationary process.
We need to think carefully about how we set up a multivariate regression if our response variable is stationary.

One recommendation is if $x_t$ is differenced, the same differencing is applied to the covariates.  The idea is if the response variable is stationary, we want to make sure that the independent variables are also stationary.  However, in a fisheries application $x_t - x_{t-1}$ often has a biological meaning, the yearly (or monthly or hourly) rate of change, and that rate of change is what one is trying explain with a covariate.  One would not necessarily expect the first difference to be stationary and one is trying to explain any trend in the one-step rate of change with some set of covariates.  On the other hand, if the response variable, the raw data or the first or second difference, is stationary then trying to explain its variability via a non-stationary covariate will clearly lead to the effect size of the covariates being zero.  We don't need to fit a model to tell us that.

